---
title: "Hogs in the Marsh analyses"
author: "Marc J S Hensel"
date: "5/6/2021"
output: html_document
---
Here is all of the code for analyses and figures for Hensel et al 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Packages needed for now.  Update as necessary

```{r packages/funcs, echo = F}
setwd("~/Documents/R projects/Hog data code")

library(lubridate)
library(tidyverse)
library(lme4)
library(lmerTest)
library(car)
library(knitr)
library(DHARMa)
library(emmeans)
library(broom); library(kableExtra); library(pixiedust)
library(patchwork)

SE <- function(x) sd(x)/sqrt(length(x))
```


### Figure 1 Experimental Hog Exclusions: patch recovery experiment
The effect of hog exclusion on the recovery of salt marsh patches at two sites over 2 years

```{r Patch Recovery Experiment Data}
patchrecovFinal <- read.csv("./patchrecovFinal.csv")
patchrecovFinal$Date <- as.Date(patchrecovFinal$Date, format = '%m/%d/%y')

patchrecovTable <- patchrecovFinal %>%
  group_by(Date, Treatment) %>% 
  summarise(mean_cover_change = mean(per.final), SE = SE(per.final))  

```
Site: site Kenan or Miller Pump
Date: sampling date in M/D/Y
Plot: Plot number 1-8
Treatment: Control or Exclusion
per.initial: percent cover of plot at beginning of exp (50%)
per.final: percent cover of plot at sampling date
per.change: per.final - per.initial at sampling date


```{r Fig 1}
Fig1 = 
ggplot(data = patchrecovFinal, aes(group = Treatment) ) +
 stat_summary(aes(x=Date, y = per.final, lty = Treatment), geom = "line", fun.data = "mean_se", size = 1.4) +
  stat_summary(aes(x=Date, y = per.final, group = Treatment), geom = "pointrange", fun.data = "mean_se", size = 1, shape = "circle") +
  labs(x = "Sampling date", y = expression("Percent cordgrass cover/plot" )) +
  geom_hline(yintercept = 50, color = "red") +
  ylim(25, 100) +
  scale_x_continuous(labels=c("Jul 2013", "Jan 2014", "Jul 2014", "Jan 2015", "Jul 2015")) +
  scale_linetype_discrete(name = "", breaks = c("Exclusion", "Control"), labels = c("Hog Exclusion", "No Exclusion")) +
  theme(legend.title = element_blank(), 
        legend.text = element_text(size = 12)) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=20), 
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank(), panel.background = element_blank())

Fig1
```

#Stats for Experimental Hog Exclusion: patch recovery experiment

```{r FIG 1 STATS MIXED EFFECTS}

patchrecov_mer <- lmer(per.final ~ Date*Treatment + (1|Site) + (1|Plot), REML = T , data = patchrecovFinal)

summary(patchrecov_mer)
patchrecov.anova = Anova(patchrecov_mer, test.statistic = "F")
```

#Supp Table 2
```{r make Supp Table 2}

Patchrecovtidy <- tidy(patchrecov.anova)

patchrecov_dust_table <- dust(Patchrecovtidy) %>%
  sprinkle(col = 2:4, round = 3) %>%
  sprinkle(col = 5, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    Df.res = "dF residual",
                    statistic = "F",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Sampling Date", "Exclusion Treatment", "Sampling Date * Treatment")) %>%
  #sprinkle(bg_pattern = c("grey")) %>%
  kable() %>%
  kable_styling()

patchrecov_dust_table
```


#Figure 2: Experimental hog exclusions: hog x mussel experiment 
Hog presence reverses a salt marsh positive interaction network

Here is the results from the hogXmussel experiment, fully factorial hog and mussel addition treatments.  Mussel additions were pressed after year 1 and 2.  RVs are all relevant to the positive int network described by Angelini et al.  RVs presented are final (ie end of the experiment). All plots started w same density of individuals
RVs-  live Spartina biomass/m2
      ribbed mussel density/m2
      crab burrow density/m2 (fiddler, mud, purple marsh crab burrows)

Read this data in.  it has all the RVs from this experiment
```{r end of experiment data for the hog x mussel experiment}
HMMaster <- read.csv("./finalhogmussel.csv") %>% select(-X)
```
Site
Date
Plot: 1-10
Treatment: treatment written out in full
Mussels: + or O
Control/Exclusion: C or E , Hog Control or Hog Exclusion
sp_biom = spartina biomass
mussel.dens = mussel density / m2
crab.dens = fiddler, marsh, mud crab burrow density /m2

##Fig 4

```{r, Fig 4}
sp.biomFIG = 
  ggplot(data = HMMaster) +
  stat_summary(aes(x = Treatment, y = sp.biom, shape = Mussels), geom = "pointrange", fun.data = "mean_se", size = 1.6, position = position_dodge(width = 0.3)) +
  stat_summary(aes(x = Treatment, y = sp.biom, group = Mussels), geom = "line", fun.data = "mean_se", size = 1, alpha = .5, position = position_dodge(width = 0.3)) +
  labs(x = "", y = expression("Cordgrass biomass g/m" ^2 )) +
  theme(legend.title = element_blank(),
        legend.text = element_text(size = 12)) +
  theme(legend.justification=c(1,1), legend.position=c(1,1)) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=18),
        axis.text.x = element_text(angle=0, vjust=1, hjust =.5, color = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank())

mussFIG = 
  ggplot(data = HMMaster) +
  stat_summary(aes(x = Treatment, y = mussel.dens, shape = Mussels), geom = "pointrange", fun.data = "mean_se", size = 1.6, position = position_dodge(width = 0.2)) +
  stat_summary(aes(x = Treatment, y = mussel.dens, group = Mussels), geom = "line", fun.data = "mean_se", size = 1, alpha = .5, position = position_dodge(width = 0.2)) +
  labs(x = "", y = expression("Mussels /m" ^2 )) +
  theme(legend.position = "none") +
  #theme(legend.title = element_blank(),
  #      legend.text = element_text(size = 12)) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=18),
        axis.text.x = element_text(angle=0, vjust=1, hjust =.5, color = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank())

crabFIG = 
  ggplot(data = HMMaster) +
  stat_summary(aes(x = Treatment, y = crab.dens, shape = Mussels), geom = "pointrange", fun.data = "mean_se", size = 1.6, position = position_dodge(width = 0.3)) +
  stat_summary(aes(x = Treatment, y = crab.dens, group = Mussels), geom = "line", fun.data = "mean_se", size = 1, alpha = .5, position = position_dodge(width = 0.3)) +
  labs(x = "", y = expression("Crab burrows /m" ^2 )) +
  theme(legend.position = "none") +
  #theme(legend.title = element_blank(),
  #      legend.text = element_text(size = 12)) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=18),
        axis.text.x = element_text(angle=0, vjust=1, hjust =.5, color = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())

```

```{r, Fig 2 }
Fig2 = (sp.biomFIG / mussFIG / crabFIG) + plot_annotation(tag_levels = 'A')
```


Fig2

##Fig 2 stats

```{r Supp Table 3}
#Spartina biomass model
biom.lme <- lmer(sp.biom ~ Treatment * Mussels + (1|Site), data = HMMaster, REML = T)
biom.anova = Anova(biom.lme, test.statistic = "F")
#run tukeys contrast test w KF df
biom_em <- emmeans(biom.lme, specs = pairwise ~ Treatment:Mussels)
biom_em$contrasts
#check normality
plot(simulateResiduals(biom.lme))

#mussel model
hmmuss.lme <- lmer(mussel.dens ~ Treatment * Mussels + (1|Site), data = HMMaster, REML = T)
muss.anova = Anova(hmmuss.lme, test.statistic = "F")
#run tukeys contrast test w KF df
hmmuss_em <- emmeans(hmmuss.lme, specs = pairwise ~ Treatment:Mussels)
hmmuss_em$contrasts
#check normality
plot(simulateResiduals(hmmuss.lme))

#crab model
crab.lme <- lmer(crab.dens ~ Treatment * Mussels + (1|Site), data = HMMaster, REML = T)
crab.anova = Anova(crab.lme, test.statistic = "F")
#run tukeys contrast test w KF df
fids_em <- emmeans(fids.lme, specs = pairwise ~ Treatment:Mussels)
fids_em$contrasts
#check normality
plot(simulateResiduals(fids.lme))
```


```{r Build Supp Table 3}
Biomtidy <- tidy(biom.anova)
Musstidy <- tidy(muss.anova)
Crabtidy <- tidy(crab.anova)

biom_dust_table <- dust(Biomtidy) %>%
  sprinkle(col = 2:4, round = 3) %>%
  sprinkle(col = 5, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    Df.res = "dF residual",
                    statistic = "F",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog Exclusion Treatment", "Mussel Treatment", "Exclusion * Mussels")) %>%
  #sprinkle(bg_pattern = c("grey")) %>%
  kable() %>%
  kable_styling()

muss_dust_table <- dust(Musstidy) %>%
  sprinkle(col = 2:4, round = 3) %>%
  sprinkle(col = 5, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    Df.res = "dF residual",
                    statistic = "F",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog Exclusion Treatment", "Mussel Treatment", "Exclusion * Mussels")) %>%
  #sprinkle(bg_pattern = c("grey")) %>%
  kable() %>%
  kable_styling()

crab_dust_table <- dust(Crabtidy) %>%
  sprinkle(col = 2:4, round = 3) %>%
  sprinkle(col = 5, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    Df.res = "dF residual",
                    statistic = "F",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog Exclusion Treatment", "Mussel Treatment", "Exclusion * Mussels")) %>%
  #sprinkle(bg_pattern = c("grey")) %>%
  kable() %>%
  kable_styling()


biom_dust_table
muss_dust_table
crab_dust_table
```


biom_dust_table
muss_dust_table
crab_dust_table

#Figure 3: Pictures from Drone Surveys

#Figure 4: 
Drone survey of sites with different levels of hog activity.  Gradient on x axis is how much predicticed hog damage occurs in a given hectare of marsh.  This is calculated through land cover data in a published study from Sharp et al. 

```{r, load in survey stats data and mussel data}
surveystats_fixed <- read.csv("./surveystats_PUB.csv")
muss_data <- read.csv("./muss.surv_raw.csv")
```
site: site
pred.disturb: predicted level of hog disturbance (m2 disturbance per 10000 m2)
pred.level: low, medium, high correlate w pred.disturb
flight: name of flight.  at most 2 flights per site
patcharea: area (m) of patches
mudarea: area (m) of mud (inverse grass)

RVs:  total number of patches
      mean patch area

totalP below is the total number of patches in each flight per site

```{r Fig 4ab patches }
Fig4b =
surveystats_fixed %>% group_by(pred.level, site) %>%
  summarise(totalP = length(patcharea)) %>% summarise(totP = mean(totalP), SE = SE(totalP)) %>%
  ggplot(data = ., aes(x = pred.level, y = totP)) +
  geom_point(size = 8) +
  geom_errorbar(aes(x = pred.level, ymin = totP + -SE, ymax = totP + SE, width = 0), size =1.5) +
  scale_x_discrete(limits = c("low", "medium", "high")) +
  labs(x = expression("Hog activity level") , y = expression("number of remnant patches")) +
  theme(axis.line = element_line(colour = "black"), text = element_text(size=18),
        axis.text.x = element_text(angle=0, vjust=1, hjust =.5, color = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank())

Fig4a = 
surveystats_fixed %>% group_by(pred.level) %>%
  summarise(meanA = mean(patcharea), SE = SE(patcharea)) %>%
  ggplot(data = ., aes(x = pred.level, y = meanA)) +
  geom_point(size = 8) +
  geom_errorbar(aes(x = pred.level, ymin = meanA + -SE, ymax = meanA + SE, width = 0), size = 1.5) +
  scale_x_discrete(limits = c("low", "medium", "high")) +
  labs(x = "" , y = expression("remnant patch area " (m^2))) +
  theme(axis.line = element_line(colour = "black"), text = element_text(size=18),
        axis.text.x = element_text(angle=0, vjust=1, hjust =.5, color = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank())
```


#Figure 4cd
```{r Fig 4dc}
Fig4d =
muss_data %>%
  group_by(Hog, Area, Site) %>%
  summarize(per.ass = mean(sum(Cord)/length(Cord))*100) %>%
  ggplot(data = ., aes(x = Hog, y = per.ass, shape = Area)) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", size = 1.6, position = position_dodge(width = 0.2)) +
 # stat_summary(aes(group = Area), geom = "line", fun.data = "mean_se", size = 1, alpha = .5, position = position_dodge(width = 0.3)) +
  scale_x_discrete(limits = c("low", "high")) +
  labs(x = "Hog activity level", y = expression("Cordgrass-mussel association %")) +
  ylim(0,105) +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=18),axis.text.x = element_text(angle=0, vjust=1, hjust =0.5, color = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(),panel.background = element_blank())

Fig4c = 
muss_data %>% group_by(Hog, Area, Site) %>%
  summarise(muss_tot = sum(No.muss)) %>% #calculate mussels per transect 120m2
  ggplot(data =., aes(x = Hog, y = muss_tot, shape = Area), position = position_dodge(0.1)) +
  stat_summary(fun.data = "mean_cl_normal", geom = "pointrange", size = 1.6, position = position_dodge(width = 0.2)) +
  scale_x_discrete(limits = c("low", "high")) +
  labs(x = "", y ="mussels per 120 m transect ") +
  theme(legend.title = element_blank(),
        legend.text = element_text(size = 12)) +
  theme(legend.justification=c(1,1), legend.position=c(1,1)) +
  theme(axis.line = element_line(colour = "black"), text = element_text(size=18),
        axis.text.x = element_text(angle=0, vjust=1, hjust =0.5, color = "black"),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.border = element_blank(), panel.background = element_blank())
```


```{r, Fig 2 }
Fig4 = (Fig4a + Fig4c) / (Fig4b + Fig4d) + plot_annotation(tag_levels = 'A')
```

Fig4

#Fig 4 stats
```{r Fig 4 stats}
#calculate total no patches
ssMod = surveystats_fixed %>% group_by(pred.level, flight) %>%
  summarise(totalP = length(patcharea))
#number of remnant patches model 4a
nopatches_glmer <- glmer(totalP ~ pred.level + (1|site), family = poisson, data = ssMod)
nopatches.anova = Anova(nopatches_glmer)
#check normality
plot(simulateResiduals(nopatches_glmer))

#patch area model
patcharea_glmer <- glmer(patcharea ~ pred.level * (1|site), family = Gamma, data = surveystats_fixed)
patcharea.anova = Anova(patcharea_glmer)
#check normality
plot(simulateResiduals(patcharea_glmer))

#number of mussels per marsh model
muss.glmer.nb <- glmer.nb(No.muss ~ Hog * Area * (1|Site), data = muss_data)
Nomuss.anova = Anova(muss.glmer.nb)
#posthoc contrasts
muss_em <- emmeans(muss.glmer.nb, specs = pairwise ~ Hog:Area)
muss_em$contrasts
#check normality
plot(simulateResiduals(muss.glmer.nb)) #deviation just at high numbers, but high reps mean its likely ok

#calculate % association
muss.glmdat <- muss_data %>% group_by(Hog, Area, Site) %>%
  summarize(yes = sum(Cord), tot = length(Cord), proyes = sum(Cord)/length(Cord))
#mussel cordgrass association model
muss.ass.glm <- glmer(proyes ~ Hog * Area + (1|Site) , data = muss.glmdat, family = binomial, weights = tot)
mussass.anova = Anova(muss.ass.glm)
#check normality
plot(simulateResiduals(muss.ass.glm))
```

```{r Build Supp Table 4}
Nopatchestidy <- tidy(nopatches.anova)
Patchareatidy <- tidy(patcharea.anova)
Nomusstidy <- tidy(Nomuss.anova)
Mussasstidy <- tidy(mussass.anova)

nopatch_dust_table <- dust(Nopatchestidy) %>%
  sprinkle(col = 2, round = 3) %>%
  sprinkle(col = 4, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    statistic = "Chi-sq",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog activity level")) %>%
  kable() %>%
  kable_styling()

patcharea_dust_table <- dust(Patchareatidy) %>%
  sprinkle(col = 2, round = 3) %>%
  sprinkle(col = 4, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    statistic = "Chi-sq",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog activity level")) %>%
  kable() %>%
  kable_styling()

nomuss_dust_table <- dust(Nomusstidy) %>%
  sprinkle(col = 2, round = 3) %>%
  sprinkle(col = 4, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    statistic = "Chi-sq",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog activity level", "Marsh Location", "Hog activity level * Marsh Location")) %>%
  kable() %>%
  kable_styling()

mussass_dust_table <- dust(Mussasstidy) %>%
  sprinkle(col = 2, round = 3) %>%
  sprinkle(col = 4, 
           fn = quote(pvalString(value))) %>%
  sprinkle_colnames(term = "Term", 
                    df = "dF",
                    statistic = "Chi-sq",
                    p.value = "P-value")%>%
  sprinkle(cols = "term", 
           replace = c("Hog activity level", "Marsh Location", "Hog activity level * Marsh Location")) %>%
  kable() %>%
  kable_styling()


nopatch_dust_table
patcharea_dust_table
nomuss_dust_table
mussass_dust_table
```





####Supplemental Materials

#S Table 1, hog feces survey

Results from a haphazard hog feces survey in Sapelo marshes over 2 summers.  Whether or not the feces had mussel shells in it was recorded

```{r read in Hog feces survey data data}
poop <- read.csv("./poop.csv")

#create a table of total feces found with shells
pootable <- poop %>%
  group_by(Site) %>% 
  summarise(totalshells = sum(shells), totalpoop = sum(total))

#lm shows no difference
poop_lm <- lm(shells ~ no.shells, data = poop)
anova(poop_lm)

```


#S Fig 1, mussel transplant experiment
Mussels were transplanted in beds into areas with grass and adjacent mud.  Survival over a week was measured at two sites.  

#Mussel transplant exp
```{r muss trans data}
muss.trans <- read.csv("~/Documents/R projects/Hog data code/muss.trans.csv")

```
Site: Site
Location: mud flat or patch of spartina
Rep: 1-8 
Initial.mussel.number; 20 mussels in each mound
muss.liveD3: number of mussels alive after day 3

```{r, muss trans stats}

muss.surv <- muss.trans %>%
  group_by(Site, Location, Rep) %>% 
  summarise(per.surv = mean(muss.liveD3/Initial.mussel.number))
  
trans_mod <- lm(muss.liveD3 ~ Site*Location+0, data = muss.trans)

anova(trans_mod)
summary(trans_mod)

trans_glm <- glm(per.surv ~ Location * Site, 
                     family = quasibinomial, 
                     data = muss.surv)
Anova(trans_glm, test.statistic = "F")
summary(trans_glm)

```


```{r, results table mussel transpltna}
  muss.trans %>%
  group_by(Location) %>% 
  summarise(per.surv = mean(muss.liveD3/Initial.mussel.number), SE = SE(muss.liveD3/Initial.mussel.number))


```


```{r, SFig1 plot}

  muss.trans %>%
  group_by(Location, Site) %>% 
  summarise(per.surv = mean(muss.liveD3/Initial.mussel.number), SE = SE(muss.liveD3/Initial.mussel.number)) %>%
  ggplot(data = ., aes(x = Location, y = per.surv, shape = Location)) +
  geom_point(size = 4) +
  geom_errorbar(aes(x = Location, ymin = per.surv + -SE, ymax = per.surv + SE, width = 0)) +
  facet_wrap(~Site) +
  ylim(0, 1) +
  labs(x = "", y = expression("Proportion of mussels alive after 10 days" )) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=14),
        axis.text.x = element_text(angle=0, vjust=1, color = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position = 'none')


##how did that stat_summary stuff work above but not here? I dont know
#ggplot(muss.trans, aes(x=Location, y = muss.liveD3, shape = Location)) +
# geom_point(data = muss.surv, mapping=aes(y=per.surv)) +
#   stat_summary() +
# facet_wrap(~Site) +
#  labs(x = "", y = expression("proportion of mussels alive" )) +
#  ylim(0,1)+
#  theme(axis.line = element_line(colour = "black"),
#        text = element_text(size=20),
#        axis.text.x = element_text(angle=70, vjust=1, hjust = 1),
#        panel.grid.major = element_blank(),
#        panel.grid.minor = element_blank(),
#        panel.border = element_blank(),
#        panel.background = element_blank())
```


```{r}
muss.percap.dat <- read.csv("~/Documents/R projects/Hog data code/mussgone.percap.csv")

```


```{r}
 muss.percap.dat %>%
  group_by(Site, muss.alive, muss.gone.day) %>%
  ggplot(data = ., aes(x = muss.alive, y = muss.gone.day)) + 
  stat_summary() +
    labs(x = "mussels remaining/mound", y = "mussels eaten/day") +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=14),
        axis.text.x = element_text(angle=0, vjust=1, color = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position = 'none')
```



```{r}

```











      
############ EXTRA- CAN IGNORE!!!!!!!!!!! ################

```{r, Fig 4a stats density not biomass!}
######Live Biomass######
HMGrass <- finalhogmussel %>%
  group_by(Mussels, Control.Exclusion, Site, Plot) %>% 
  summarise(sp.dens = (mean(c(livegrass_1, livegrass_2, livegrass_3)))*4)

livegrass_mod <- lm(sp.dens ~ Control.Exclusion * Site*Mussels+0, data = HMGrass)
livea1 <- aov(sp.dens ~ Control.Exclusion * Site*Mussels, data = HMGrass) #need aov for the tukeys

livegrass.glm <- lmer(sp.dens ~ Control.Exclusion *Mussels + (1|Site), data = HMGrass, REML = T)
Anova(livegrass.glm, test.statistic = "F")
summary(livegrass.glm)


Anova(livegrass_mod)
summary(livegrass_mod)
TukeyHSD(livea1)


```
  
  
```{r echo = FALSE, results = 'asis'}
kable(Anova(livegrass.glm))
```


## Fig 2d, crab burrow density
CUT CUT CUT CUT DONT USE ANYMORE!!!!!!!!!!!!!

```{r marsh crab stats}
####Crabs####
HMCrabs <- finalhogmussel %>%
  group_by(Mussels, Control.Exclusion, Site, Plot) %>% 
  summarise(crab.dens = (mean(c(crabs_1, crabs_2, crabs_3)))*4)

crab_mod <- lm(crab.dens ~ Control.Exclusion * Site* Mussels+0, data = HMCrabs)
a9 <- aov(crab.dens ~ Control.Exclusion * Mussels, data = HMCrabs)
anova(crab_mod)
summary(crab_mod)
TukeyHSD(a9)
```


I thought- what if I calculated RATE of change in the patch recovery exp.  that is here

Months since is a column i created which is the time, in months, since the last measurement.  Thus this is going to be the rate of change at each plot over time 
```{r calculate and graph recovery rate per month}
patchrecovrate <- patchrecovFinal %>%
  group_by(Date, Treatment, Plot, mths.since) %>% 
  summarise(recov_rate_month = mean(per.change)/mths.since,  recov_rate_year = mean(per.change)/(mths.since/12)) 

patchrecovrate %>%
  group_by(Treatment, recov_rate_month)

patchrecovrate_mod <- lm(recov_rate_month ~ Treatment * Site * Date+0, data = patchrecovrate)

#not really sure why the plus 0 but make sure the lm is here
aRate <- aov(recov_rate_month ~ Treatment * Site * Date, data = patchrecovrate) #need aov for the tukeys
Anova(patchrecovrate_mod)
summary(patchrecovrate_mod)
TukeyHSD(aRate)

```

```{r Box plot that shows recovery rate per month}

patchrecovFinal %>%
  group_by(Treatment, Plot, mths.since) %>% 
  summarise(recov_rate_month = mean(per.change/mths.since)) %>%
  ggplot(data = ., aes(x = Treatment, y = recov_rate_month)) +
  geom_boxplot() +
  labs(x = "", y = expression("% recovery/month" )) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size= 14),
        axis.text.x = element_text(angle=0, vjust=0, hjust = .5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())
```











##########TRASH###############
```{r recovery rate per year }
patchrecovFinal %>%
  group_by(Site, Treatment) %>% 
  summarise(recov_rate_month = mean(per.change)/24,  recov_rate_year = mean(per.change)/2, SE= SE(recov_rate_month))  %>%
  ggplot(data = ., aes(x = Date, y = recov_rate_year)) +
  geom_point() +
  geom_line(aes(group = paste0(Treatment), linetype = Treatment)) +
  geom_errorbar(aes(ymin = recov_rate_year + (-SE(recov_rate_year)), ymax = recov_rate_year + d(SE(recov_rate_year)), width = 0.2)) +
  labs(x = "", y = expression("% of plot recovered/year" )) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=16),
        axis.text.x = element_text(angle=40, vjust=1, hjust = 1),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())
```

```{r}
patchrecovFinal %>%
  group_by(Treatment) %>% 
  summarise(mean_cover_change = mean(per.final)/2.5, SE = (mean_cover_change = mean(per.final)/2.5)) %>%
  ggplot(data = ., aes(x = Treatment, y = mean_cover_change)) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = mean_cover_change + -SE, ymax = mean_cover_change + SE, width = 0.1)) +
  labs(x = "", y = expression("Mean recovery rate/year" )) +
  ylim(0, 50) +
  theme(axis.line = element_line(colour = "black"),
        text = element_text(size=14),
        axis.text.x = element_text(angle=00, vjust=0, hjust = 1),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())
```

      
      
      
      
